<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>游戏游戏游戏O(∩_∩)O~~ | 爱学习居士</title><meta name="author" content="爱学习居士"><meta name="copyright" content="爱学习居士"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="最近有做到两类不同的游戏类的题，尤其是unity游戏逆向，这个我感觉还挺有意思的，而且近期出现的还蛮多的，浅浅记录一下O(∩_∩)O~~ unity3D它允许开发者通过可视化工具和编程快速构建 2D&#x2F;3D 游戏、动画等内容，并发布到多个平台（如 PC、手机、主机等）。  一大优点是跨平台，支持它能跨平台的得力于两种脚本处理的方式  Mono  传统 C# 解释执行，兼容性好但性能较低（">
<meta property="og:type" content="article">
<meta property="og:title" content="游戏游戏游戏O(∩_∩)O~~">
<meta property="og:url" content="http://example.com/posts/a1786872/index.html">
<meta property="og:site_name" content="爱学习居士">
<meta property="og:description" content="最近有做到两类不同的游戏类的题，尤其是unity游戏逆向，这个我感觉还挺有意思的，而且近期出现的还蛮多的，浅浅记录一下O(∩_∩)O~~ unity3D它允许开发者通过可视化工具和编程快速构建 2D&#x2F;3D 游戏、动画等内容，并发布到多个平台（如 PC、手机、主机等）。  一大优点是跨平台，支持它能跨平台的得力于两种脚本处理的方式  Mono  传统 C# 解释执行，兼容性好但性能较低（">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://example.com/image/2.jpg">
<meta property="article:published_time" content="2025-07-08T10:39:25.000Z">
<meta property="article:modified_time" content="2025-07-15T02:55:10.031Z">
<meta property="article:author" content="爱学习居士">
<meta property="article:tag" content="u3d">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://example.com/image/2.jpg"><script type="application/ld+json">{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "游戏游戏游戏O(∩_∩)O~~",
  "url": "http://example.com/posts/a1786872/",
  "image": "http://example.com/image/2.jpg",
  "datePublished": "2025-07-08T10:39:25.000Z",
  "dateModified": "2025-07-15T02:55:10.031Z",
  "author": [
    {
      "@type": "Person",
      "name": "爱学习居士",
      "url": "http://example.com/"
    }
  ]
}</script><link rel="shortcut icon" href="/img/favixon.jpg"><link rel="canonical" href="http://example.com/posts/a1786872/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><script>
    (() => {
      
    const saveToLocal = {
      set: (key, value, ttl) => {
        if (!ttl) return
        const expiry = Date.now() + ttl * 86400000
        localStorage.setItem(key, JSON.stringify({ value, expiry }))
      },
      get: key => {
        const itemStr = localStorage.getItem(key)
        if (!itemStr) return undefined
        const { value, expiry } = JSON.parse(itemStr)
        if (Date.now() > expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return value
      }
    }

    window.btf = {
      saveToLocal,
      getScript: (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        Object.entries(attr).forEach(([key, val]) => script.setAttribute(key, val))
        script.onload = script.onreadystatechange = () => {
          if (!script.readyState || /loaded|complete/.test(script.readyState)) resolve()
        }
        script.onerror = reject
        document.head.appendChild(script)
      }),
      getCSS: (url, id) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onload = link.onreadystatechange = () => {
          if (!link.readyState || /loaded|complete/.test(link.readyState)) resolve()
        }
        link.onerror = reject
        document.head.appendChild(link)
      }),
      addGlobalFn: (key, fn, name = false, parent = window) => {
        if (!true && key.startsWith('pjax')) return
        const globalFn = parent.globalFn || {}
        globalFn[key] = globalFn[key] || {}
        globalFn[key][name || Object.keys(globalFn[key]).length] = fn
        parent.globalFn = globalFn
      }
    }
  
      
      const activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      const activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }

      btf.activateDarkMode = activateDarkMode
      btf.activateLightMode = activateLightMode

      const theme = saveToLocal.get('theme')
    
          theme === 'dark' ? activateDarkMode() : theme === 'light' ? activateLightMode() : null
        
      
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        document.documentElement.classList.toggle('hide-aside', asideStatus === 'hide')
      }
    
      
    const detectApple = () => {
      if (/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)) {
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
  
    })()
  </script><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false,"highlightFullpage":false,"highlightMacStyle":true},
  copy: {
    success: '复制成功',
    error: '复制失败',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'null',
  Snackbar: undefined,
  infinitegrid: {
    js: 'https://cdn.jsdelivr.net/npm/@egjs/infinitegrid/dist/infinitegrid.min.js',
    buttonText: '加载更多'
  },
  isPhotoFigcaption: false,
  islazyloadPlugin: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '游戏游戏游戏O(∩_∩)O~~',
  isHighlightShrink: true,
  isToc: true,
  pageType: 'post'
}</script><link rel="stylesheet" href="/css/custom_cursor.css"><link rel="stylesheet" href="/css/custom.css"><link rel="stylesheet" href="/styles/main.css"><meta name="generator" content="Hexo 7.3.0"></head><body><div id="web_bg" style="background-image: url(/image/photo.png);"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img text-center"><img src="/image/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data text-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw far fa-comments"></i><span> 叽里呱啦</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友人账</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(/image/2.jpg);"><nav id="nav"><span id="blog-info"><a class="nav-site-title" href="/"><img class="site-icon" src="/img/avatar.jpg" alt="Logo"><span class="site-name">爱学习居士</span></a><a class="nav-page-title" href="/"><span class="site-name">游戏游戏游戏O(∩_∩)O~~</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/shuoshuo/"><i class="fa-fw far fa-comments"></i><span> 叽里呱啦</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友人账</span></a></div></div><div id="toggle-menu"><span class="site-page"><i class="fas fa-bars fa-fw"></i></span></div></div></nav><div id="post-info"><h1 class="post-title">游戏游戏游戏O(∩_∩)O~~</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2025-07-08T10:39:25.000Z" title="发表于 2025-07-08 18:39:25">2025-07-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2025-07-15T02:55:10.031Z" title="更新于 2025-07-15 10:55:10">2025-07-15</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%B8%B8%E6%88%8F/">游戏</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title=""><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">浏览量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="container post-content" id="article-container"><p> 最近有做到两类不同的游戏类的题，尤其是unity游戏逆向，这个我感觉还挺有意思的，而且近期出现的还蛮多的，浅浅记录一下O(∩_∩)O~~</p>
<h2 id="unity3D"><a href="#unity3D" class="headerlink" title="unity3D"></a>unity3D</h2><p>它允许开发者通过可视化工具和编程快速构建 2D&#x2F;3D 游戏、动画等内容，并发布到多个平台（如 PC、手机、主机等）。</p>
<p><img src="/../textimg/game.assets/image-20250531210953147.png" alt="image-20250531210953147"></p>
<p>一大优点是跨平台，支持它能跨平台的得力于两种脚本处理的方式</p>
<ul>
<li><strong>Mono</strong></li>
</ul>
<p>传统 C# 解释执行，兼容性好但性能较低（<strong>逐渐淘汰</strong>）。</p>
<p>构建应用非常快，必须将代码发布成托管程序集（.dll文件，由mono或者.net生成）。</p>
<ul>
<li><strong>IL2CPP</strong></li>
</ul>
<p>将 C# 转为 C++ 再编译，提升性能（<strong>主流选择</strong>，但逆向难度更高）。</p>
<p>相比Mono构建应用慢，可以启用引擎代码剥离（Engine code stripping）来减少代码的大小。</p>
<p>篇文章对这两个部分有很好的解释</p>
<p><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/141748334">Unity之IL2CPP - 知乎</a></p>
<p>所以对我们做题来说</p>
<h3 id="Momo出包"><a href="#Momo出包" class="headerlink" title="Momo出包"></a>Momo出包</h3><p>主要逻辑在Assembly-CSharp.dl</p>
<p>这是 Unity 默认将开发者编写的 C# 代码编译成的动态链接库（DLL），包含游戏的核心逻辑（如角色控制、UI、游戏规则等）。</p>
<p>所以我们只需要把Assembly-CSharp.dl放到dnsy里面反汇编，分析代码逻辑即可</p>
<p>这里我之前做过几个</p>
<h4 id="BJDCTF2020-BJD-hamburger-competition"><a href="#BJDCTF2020-BJD-hamburger-competition" class="headerlink" title="[BJDCTF2020]BJD hamburger competition"></a>[BJDCTF2020]BJD hamburger competition</h4><p>玩一下游戏发现是这样子的</p>
<p><img src="/../textimg/game.assets/image-20250531201956487.png" alt="image-20250531201956487"></p>
<p>用dnsy打开.dll，在{}里面找关键的函数</p>
<p>玄机在ButtonSpawnFruit处，主要是因为这里面有输出的字还有flag的标识</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line">using System;</span><br><span class="line">using System.Security.Cryptography;</span><br><span class="line">using System.Text;</span><br><span class="line">using UnityEngine;</span><br><span class="line"></span><br><span class="line">// Token: 0x02000004 RID: 4</span><br><span class="line">public class ButtonSpawnFruit : MonoBehaviour</span><br><span class="line">&#123;</span><br><span class="line">	// Token: 0x0600000A RID: 10 RVA: 0x00002110 File Offset: 0x00000310</span><br><span class="line">	public static string Md5(string str)</span><br><span class="line">	&#123;</span><br><span class="line">		byte[] bytes = Encoding.UTF8.GetBytes(str);</span><br><span class="line">		byte[] array = MD5.Create().ComputeHash(bytes);</span><br><span class="line">		StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">		foreach (byte b in array)</span><br><span class="line">		&#123;</span><br><span class="line">			stringBuilder.Append(b.ToString(&quot;X2&quot;));</span><br><span class="line">		&#125;</span><br><span class="line">		return stringBuilder.ToString().Substring(0, 20);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	// Token: 0x0600000B RID: 11 RVA: 0x00002170 File Offset: 0x00000370</span><br><span class="line">	public static string Sha1(string str)</span><br><span class="line">	&#123;</span><br><span class="line">		byte[] bytes = Encoding.UTF8.GetBytes(str);</span><br><span class="line">		byte[] array = SHA1.Create().ComputeHash(bytes);</span><br><span class="line">		StringBuilder stringBuilder = new StringBuilder();</span><br><span class="line">		foreach (byte b in array)</span><br><span class="line">		&#123;</span><br><span class="line">			stringBuilder.Append(b.ToString(&quot;X2&quot;));</span><br><span class="line">		&#125;</span><br><span class="line">		return stringBuilder.ToString();</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public void Spawn()</span><br><span class="line">	&#123;</span><br><span class="line">		FruitSpawner component = GameObject.FindWithTag(&quot;GameController&quot;).GetComponent&lt;FruitSpawner&gt;();</span><br><span class="line">		if (component)</span><br><span class="line">		&#123;</span><br><span class="line">			if (this.audioSources.Length != 0)</span><br><span class="line">			&#123;</span><br><span class="line">				this.audioSources[Random.Range(0, this.audioSources.Length)].Play();</span><br><span class="line">			&#125;</span><br><span class="line">			component.Spawn(this.toSpawn);</span><br><span class="line">			string name = this.toSpawn.name;</span><br><span class="line">			if (name == &quot;汉堡底&quot; &amp;&amp; Init.spawnCount == 0)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret += 997;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;鸭屁股&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret -= 127;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;胡罗贝&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret *= 3;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;臭豆腐&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret ^= 18;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;俘虏&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret += 29;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;白拆&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret -= 47;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;美汁汁&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret *= 5;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;柠檬&quot;)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret ^= 87;</span><br><span class="line">			&#125;</span><br><span class="line">			else if (name == &quot;汉堡顶&quot; &amp;&amp; Init.spawnCount == 5)</span><br><span class="line">			&#123;</span><br><span class="line">				Init.secret ^= 127;</span><br><span class="line">				string str = Init.secret.ToString();</span><br><span class="line">				if (ButtonSpawnFruit.Sha1(str) == &quot;DD01903921EA24941C26A48F2CEC24E0BB0E8CC7&quot;)</span><br><span class="line">				&#123;</span><br><span class="line">					this.result = &quot;BJDCTF&#123;&quot; + ButtonSpawnFruit.Md5(str) + &quot;&#125;&quot;;</span><br><span class="line">					Debug.Log(this.result);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">			Init.spawnCount++;</span><br><span class="line">			Debug.Log(Init.secret);</span><br><span class="line">			Debug.Log(Init.spawnCount);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>分析一下可以看到，给出的字符串DD01903921EA24941C26A48F2CEC24E0BB0E8CC7是flag进行sha1加密后的值，使用工具对字符串解密。</p>
<p>解密结果md5加密后取大写前20位即为flag</p>
<h3 id="IL2CPP出包"><a href="#IL2CPP出包" class="headerlink" title="IL2CPP出包"></a>IL2CPP出包</h3><p>主要逻辑在 GameAssembly.dll（Windows）或 libil2cpp.so（Android&#x2F;iOS）</p>
<p>IL2CPP 会将 C# 代码转换为 C++，再编译为原生二进制文件，进而被封装到 GameAssembly.dll中。</p>
<p>还有一个文件global-metadata.dat：此文件包含 IL2CPP 的元数据（如类名、方法名、字段等），用于还原代码结构。</p>
<p>因而又分为两种windows下和安卓下</p>
<p>好像目前对于il2cpp逆向都以Android中的.so文件居多，弄了好几天才知道windows下的怎么操作</p>
<p>哭了::&gt;_&lt;::</p>
<h4 id="PC"><a href="#PC" class="headerlink" title="PC"></a>PC</h4><p>当我们有了以下这两个前置文件之后</p>
<p>1.GameAssembly.dll</p>
<p>2.global-metadata.dat</p>
<p>需要专门的Unity工具去dump它，这里用的工具是I2CppDumper</p>
<p>用Il2CppDumper.exe工具打开GameAssembly.dll后再选中global-metadata.dat</p>
<p>就能得到DummyDll这个文件夹里面有Assembly-CSharp.dll从而进行分析</p>
<p>当然里面还有许多其它的出现</p>
<ul>
<li>dump.cs：这个文件会把C#的dll代码的类、方法、字段列出来</li>
<li>il2cpp.h：生成的cpp的头文件，里面有相关的数据结构</li>
<li>script.json：以json格式显示类的方法信息</li>
<li>stringliteral.json：以json的格式显示所有的字符串信息</li>
</ul>
<p>其中script.json、il2cpp.h是用来恢复符号表的，恢复的是GameAssembly.dll文件</p>
<p>GameAssembly.dll文件就相当于apk的那个.so文件很重要滴</p>
<h5 id="LitCTF2025-Robbie-Wanna-Revenge"><a href="#LitCTF2025-Robbie-Wanna-Revenge" class="headerlink" title="[LitCTF2025]Robbie Wanna Revenge"></a>[LitCTF2025]Robbie Wanna Revenge</h5><p>首先是IL2CPP我们需要dump</p>
<p>但是dump不出来，发现是被魔改加壳了，在010里面将LIT都换成UPX</p>
<p><img src="/../textimg/game.assets/image-20250531222709015.png" alt="image-20250531222709015"></p>
<p>然后脱壳工具脱一下，这样就能dump了</p>
<p>先用Il2CppDumper.exe工具打开GameAssembly.dll后再选中global-metadata.dat</p>
<p><img src="/../textimg/game.assets/image-20250531213208352.png" alt="image-20250531213208352"></p>
<p>然后文件夹里发现Assembly-CSharp.dll，打开来在{}里面分析观察里面的函数</p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_24481913/article/details/148234091">LitCTF 2025 Robbie Wanna Revenge-CSDN博客</a></p>
<p>这里有两种做法</p>
<p>一种是上面链接里面写的修改程序，使小人永远不死从而拿道flag</p>
<p>我们用ida把它打开然后控制台运行这个ida_with_struct_py3.py文件</p>
<p><img src="/../textimg/game.assets/image-20250604203954469.png" alt="image-20250604203954469"></p>
<p>先选择dump出来的script.json再选il2cpp.h，就可以恢复GameAssembly.dll里面的函数啦</p>
<p>找到Assembly-CSharp.dll里面看到的playerheath函数</p>
<p>注意多个地方的跳转可以发现修改这边的jnz换成jz可以永远不死</p>
<p>右键Aessmble换一下然后Edit<code>→</code>Patch program<code>→</code>Apply patches to input file导出dll</p>
<p><img src="/../textimg/game.assets/image-20250604204356996.png" alt="image-20250604204356996"></p>
<p>然后Robbie就不会死了，可以玩游戏得到flag</p>
<p>另一种是在CE里面激活 mono 功能，然后调用PlayerWon</p>
<p>这里我就用第二种了，.Net info点开</p>
<p><img src="/../textimg/game.assets/image-20250531234618948.png" alt="image-20250531234618948"></p>
<p>在游戏管理那一类里面调用PlayerWon</p>
<p><img src="/../textimg/game.assets/image-20250531234638329.png" alt="image-20250531234638329"></p>
<h5 id="MRCTF2021-EzGame"><a href="#MRCTF2021-EzGame" class="headerlink" title="[MRCTF2021] EzGame"></a>[MRCTF2021] EzGame</h5><p>先玩一下游戏(^o^)&#x2F;~很有意思</p>
<p>如果要得到flag的话有许多条件，第一个想到的就是用ce修改一下值就可以了</p>
<p><img src="/../textimg/game.assets/image-20250704152911804.png" alt="image-20250704152911804"></p>
<p>既然是个illcpp题的话</p>
<p>老样子用Il2CppDumper.exe先dump一下拿到的dll看一看嘞</p>
<p>发现这里有界面输出的东西</p>
<p><img src="/../textimg/game.assets/image-20250704151405420.png" alt="image-20250704151405420"></p>
<p>本来想还原一下函数表的，结果一查发现这个dll有Themida壳，然后还原了也没什么用</p>
<p>最直观的就是钻石个数了，找到之后看一下汇编语言，在分析结构那边把数据结构加上去，注意字节长度，因为有些数字不知道长度直接使用指针了</p>
<p>然后修改条件的数值</p>
<p><img src="/../textimg/game.assets/image-20250704174717108.png" alt="image-20250704174717108"></p>
<p>然后回去点getflag的按钮，没给flag，明明已经满足条件了</p>
<p>想一想应该是还存在哪里检查了，单单用ce成功不了</p>
<p><img src="/../textimg/game.assets/image-20250704172136557.png" alt="image-20250704172136557"></p>
<h6 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h6><p>感觉应该是key是不断改变的，key不正确所以就不行</p>
<p>把key的地址记住放到里面，查看一下是什么写入了，吃了一个钻石之后再查看一下这两个看看里面的汇编，意思大概是八个字节被改变了</p>
<p><img src="/../textimg/game.assets/image-20250704175200043.png" alt="image-20250704175139621"></p>
<p>查看汇编，考虑先看看伪代码</p>
<p>先把它这部分内存中的东西用火绒剑dump出来</p>
<p>用这个dll的基地址加上偏移，找到覆盖目标地址的地方dump出第一个</p>
<p><img src="/../textimg/game.assets/image-20250704180326983.png" alt="image-20250704180326983"></p>
<p>因为用ida打开都是字节码，我们用函数开头的字节码信息来定位函数</p>
<p><img src="/../textimg/game.assets/image-20250704195612587.png" alt="image-20250704195612587"></p>
<p>将dump下来的文件进行分析，直接搜索函数开始的字节码，按c后再p形成函数</p>
<p>不知道为什么我的一直看不了伪代码，看了一下别人的截图里面是对key进行位运算</p>
<p>直接将自己初始的key循环进行105次，得到的key修改一下就可以了</p>
<h6 id="方法二"><a href="#方法二" class="headerlink" title="方法二"></a>方法二</h6><p>key的改变在Assembly-CSharp.dll里可以发现是每次吃到钻石后用EatTokenUpdateKey方法改变了</p>
<p><img src="/../textimg/game.assets/image-20250704200337473.png" alt="image-20250704200337473"></p>
<p>要是能调用这个函数105次就好了</p>
<p>调用需要的函数可以使用frida或者dll注入，官方wp上用的是dll注入</p>
<p>这是GameAssembly.dll里导出的函数，截了一部分</p>
<p><img src="/../textimg/game.assets/image-20250707095620034.png" alt="image-20250707095620034"></p>
<p>很多都是以il2cpp开头的，这种il2cpp_XXXX_XXXX_XXX形式的都是il2cpp源码中有的API函数</p>
<p><a target="_blank" rel="noopener" href="https://github.com/WuFengXue/il2cpp-Mirror/blob/master/il2cpp-v24.3/libil2cpp/il2cpp-api.cpp">il2cpp-Mirror&#x2F;il2cpp-v24.3&#x2F;libil2cpp&#x2F;il2cpp-api.cpp at master · WuFengXue&#x2F;il2cpp-Mirror</a></p>
<p>先挂一下地址</p>
<p><img src="/../textimg/game.assets/image-20250707172435072.png" alt="image-20250707172435072"></p>
<p>我们可以结合上面的函数调用API来写一个dll注入</p>
<p>因为这里GameAssembly.dll已经能打印这些函数了，所以我们可以用<code>GetProcAddress</code> 拿到地址，这个是系统的一个API 函数，它能从指定的dll 检索<strong>导出函数</strong>或变量的地址。</p>
<p>为什么要拿地址呢因为我们只有il2cpp.h这个文件只有函数声明，没有任何地方告诉编译器这个函数具体在哪儿实现（本地代码或外部 DLL），所以要用这个拿到地址</p>
<p>写了半天的dll注进去没成功，我笑死了咋这么命苦呢，气得我血压有点高。</p>
<p>不管了，加纳！</p>
<h6 id="方法三"><a href="#方法三" class="headerlink" title="方法三"></a>方法三</h6><p>这个方法相当于frida了，因为这个项目本身是依赖于frida的</p>
<p><a target="_blank" rel="noopener" href="https://github.com/in1nit1t/uniref">in1nit1t&#x2F;uniref: A Python coding framework for analyzing Unity applications.</a></p>
<p><img src="/../textimg/game.assets/image-20250704155148183.png" alt="image-20250704155148183"></p>
<p>直接pip安装就可以了</p>
<p>因为可以实时获取与修改类方法实现、调用类方法</p>
<p>写一个脚本调用需要的函数即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">from uniref import WinUniRef</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    f = WinUniRef(&quot;GameHack.exe&quot;)</span><br><span class="line">    class_GetFlag = f.find_class_in_image(&quot;Assembly-CSharp.dll&quot;, &quot;Platformer.Flag.GetFlag&quot;)</span><br><span class="line">    class_GetFlag.find_field(&quot;goHome&quot;).value = True</span><br><span class="line">    class_GetFlag.find_field(&quot;findAlien&quot;).value = True</span><br><span class="line">    class_GetFlag.find_field(&quot;eatCookie&quot;).value = True</span><br><span class="line"></span><br><span class="line">    method_EatTokenUpdateKey = class_GetFlag.find_method(&quot;EatTokenUpdateKey&quot;)</span><br><span class="line">    for i in range(105):</span><br><span class="line">        method_EatTokenUpdateKey()</span><br><span class="line">    print(&quot;ok&quot;)</span><br></pre></td></tr></table></figure>

<p>在task界面，运行代码改写值，再按getflag从而得到flag</p>
<p><img src="/../textimg/game.assets/image-20250704162551481.png" alt="image-20250704162551481"></p>
<p>后面发现还有一个项目也是十分强大应该也可以用这个写，先记一下</p>
<p><a target="_blank" rel="noopener" href="https://github.com/vfsfitvnm/frida-il2cpp-bridge">vfsfitvnm&#x2F;frida-il2cpp-bridge：一个 Frida 模块，用于在运行时转储、跟踪或劫持任何 IL2CPP 应用程序，而无需 global-metadata.dat 文件。</a></p>
<h4 id="Android"><a href="#Android" class="headerlink" title="Android"></a>Android</h4><p>同样是工具dump，这个只需要根据global-metadata.dat和libil2cpp.so来就可以了</p>
<p>几乎没什么区别，都是先dump再分析，最多global-metadata.dat上加了一个混淆</p>
<p>直接先看看题吧</p>
<h5 id="D3CTF-2022-D3MUG"><a href="#D3CTF-2022-D3MUG" class="headerlink" title="[D3CTF 2022] D3MUG"></a>[D3CTF 2022] D3MUG</h5><p>泥萌音游党有福了。。。</p>
<p>拿到flag的条件是all perfect，以人类的角度来说应该不可能完成</p>
<p><img src="/../textimg/game.assets/image-20250707181638228.png" alt="image-20250707181638228"></p>
<p>apk 解压后所看到的就是 arm64-v8a 和 armeabi-v7a，差不多就是 64位 和 32位的意思</p>
<p>先用工具dump一下，先点so文件，再点dat文件，方法都差不多</p>
<p>再恢复一下符号表</p>
<p>在恢复符号表的间隙先看看dump出来的Assembly-CSharp.dll，因为拿到flag的条件和分数没什么关系，主要准备从GameManager下手</p>
<p><img src="/../textimg/game.assets/image-20250707182321282.png" alt="image-20250707182321282"></p>
<p>分析一下符号表恢复了的GameAssembly.dll，先搜索了一下这一类分析了NoteHit，</p>
<p><img src="/../textimg/game.assets/image-20250707200019940.png" alt="image-20250707200019940"></p>
<p>看看更新了什么状态，啊嘞看着加载了其它模块里的方法，先放放</p>
<p><img src="/../textimg/game.assets/image-20250707202137390.png" alt="image-20250707202233700"></p>
<p>看一下是什么引用了NoteHit，反正大概是先初始化东西，然后判定时间这个意思吧</p>
<p><img src="/../textimg/game.assets/image-20250707201837301.png" alt="image-20250707201837301"></p>
<p>再往上引用基本都是游戏里面查看触碰的函数，先看看怎么引用d3mug里的update函数的</p>
<p>可以看到更新后返回的是Server::run里面的东西，根据上面看到的传递的v9是击打时间，所以是击打时间穿进去进行了加密，再点进去看看</p>
<p><img src="/../textimg/game.assets/image-20250707203859504.png" alt="image-20250707203859504"></p>
<p>里面是一个伪随机数生成算法，<strong>梅森旋转算法(MT19937)</strong> 第一次见</p>
<p><img src="/../textimg/game.assets/image-20250707204305155.png" alt="image-20250707204305155"></p>
<p>用assetstudio找打击时间这个我还是第一次遇到因为这种u3d碰到的也不多，其实是我题写太少了。</p>
<p>把apk解压后的文件放进去分析，搜了一下hit但是有三个运行一下程序可以发现是1608块的，找一个恰好有1608个的hitpoints就好了，第一列是轨道，第二列是击打时间</p>
<p><img src="/../textimg/game.assets/image-20250707210311452.png" alt="image-20250707210311452"></p>
<p>呀嘞呀嘞，这个算法看着好难啊我服了，等着到时候让密码小姐姐教我吧O(∩_∩)O~~</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/news/15327">MT19937（梅森旋转）实践训练-先知社区</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">#include &lt;stdio.h&gt;</span><br><span class="line">#include &lt;random&gt;</span><br><span class="line">#include &lt;Windows.h&gt;</span><br><span class="line"> </span><br><span class="line">using namespace std;</span><br><span class="line"> </span><br><span class="line">const DWORD hitp[] = &#123; 0,0,0,146,292,292,439,512,585,585,658,731,804,878,1024,1170,1170,1317,1463,1463,1609,1682,1756,1756,1902,2048,2195,2341,2341,2487,2634,2634,2780,2853,2926,2926,3073,3146,3219,3219,3365,3439,3512,3512,3658,3804,3878,3951,4024,4097,4097,4243,4390,4682,4682,4682,4829,4975,4975,5121,5195,5268,5341,5414,5487,5560,5560,5853,5853,5999,6146,6146,6292,6365,6439,6439,6585,6731,6731,6731,7024,7024,7170,7317,7317,7463,7536,7609,7609,7682,7756,7829,7902,7902,7975,8048,8121,8195,8341,8487,8634,8780,9073,9073,9073,9219,9365,9365,9512,9658,9658,9804,9878,9951,9951,10097,10243,10243,10243,10390,10463,10536,10536,10682,10829,10829,10975,11121,11121,11268,11414,11414,11560,11707,11707,11853,11999,11999,11999,12146,12292,12292,12439,12439,12585,12585,12585,12731,12878,12951,13024,13097,13170,13170,13317,13463,13463,13463,13609,13756,13756,13756,13902,14048,14048,14195,14341,14487,14634,14634,14926,14926,14926,15219,15219,15219,15365,15365,15512,15512,15658,15804,15804,15951,16024,16097,16097,16170,16243,16317,16390,16390,16536,16682,16682,16829,16902,16975,16975,17121,17268,17268,17268,17414,17560,17634,17707,17780,17853,17926,17999,18073,18146,18146,18292,18439,18439,18731,18731,18731,18878,19024,19024,19024,19170,19243,19317,19463,19609,19609,19609,19756,19829,19902,20048,20195,20195,20341,20487,20487,20634,20780,20780,20926,21073,21073,21219,21365,21365,21365,21512,21585,21658,21658,21804,21951,21951,21951,22097,22243,22317,22390,22463,22536,22536,22609,22682,22756,22829,22829,22975,23121,23121,23268,23414,23560,23707,23780,23853,23926,23999,23999,24073,24146,24219,24292,24365,24439,24512,24585,24585,24731,24731,24878,24878,24878,25024,25170,25170,25317,25390,25463,25463,25609,25756,25756,25756,25902,25902,26048,26048,26195,26195,26341,26341,26414,26487,26487,26560,26634,26634,26780,26780,26926,27219,27512,27585,27658,27731,27804,27804,28097,28097,28390,28682,28682,28975,29268,29268,29560,29560,29853,29853,30146,30439,30439,30731,31024,31024,31317,31609,31609,31902,32195,32195,32487,32780,32780,32780,33365,33365,33365,33951,33951,34243,34536,34536,34829,35121,35121,35414,35707,35707,35707,35999,36292,36585,36878,36878,37024,37024,37170,37170,37463,37463,37463,37609,37756,37756,37902,38048,38048,38195,38341,38341,38487,38634,38634,38780,38926,39073,39219,39365,39512,39658,39804,39804,39951,40097,40097,40243,40390,40390,40536,40682,40829,40975,40975,41121,41268,41414,41560,41707,41853,41999,42146,42146,42292,42292,42439,42585,42731,42731,42878,42878,43024,43170,43317,43317,43463,43463,43609,43609,43682,43756,43756,43829,43902,43902,44048,44048,44195,44195,44341,44341,44487,44560,44634,44707,44780,44853,44926,44999,45073,45146,45219,45292,45365,45439,45512,45585,45658,45658,45804,45951,45951,46097,46243,46243,46536,46536,46536,46829,46829,46902,46975,47121,47121,47268,47414,47414,47560,47634,47707,47707,47853,47926,47999,47999,48146,48292,48292,48439,48585,48585,48731,48878,48878,49024,49170,49170,49243,49317,49463,49463,49609,49756,49756,49902,49975,50048,50048,50121,50195,50268,50341,50341,50487,50487,50707,50707,50926,50926,51073,51219,51365,51512,51512,51585,51658,51804,51804,51951,52097,52097,52170,52243,52317,52390,52390,52536,52609,52682,52682,52829,52975,52975,53121,53268,53268,53414,53560,53560,53707,53853,53853,53926,53999,54073,54146,54146,54219,54292,54365,54439,54439,54512,54585,54658,54731,54731,54878,54878,55024,55024,55024,55317,55317,55317,55609,55609,55609,55902,55902,55902,56195,56268,56341,56487,56487,56634,56780,56780,56926,56999,57073,57073,57219,57292,57365,57365,57512,57658,57658,57804,57951,57951,58097,58243,58243,58390,58536,58536,58609,58682,58829,58829,58975,59121,59121,59268,59341,59414,59414,59560,59634,59707,59707,59853,59926,59999,59999,60073,60292,60292,60439,60585,60585,60731,60878,60878,60951,61024,61024,61170,61170,61317,61317,61463,61463,61463,61536,61609,61609,61756,61756,61902,61902,62048,62048,62048,62121,62195,62195,62341,62341,62414,62487,62560,62634,62634,62780,62780,62926,62926,63073,63073,63219,63219,63292,63365,63439,63512,63512,63585,63658,63731,63804,63804,63878,63951,64024,64097,64097,64170,64243,64317,64390,64390,64536,64536,64609,64682,64829,64975,65121,65268,65414,65560,65560,65707,65853,65999,66146,66146,66439,66585,66878,67170,67317,67317,67609,67902,68048,68195,68341,68487,68487,68780,68926,69073,69219,69365,69512,69658,69658,69804,69951,70243,70390,70536,70682,70829,70829,71121,71268,71560,71853,71999,71999,72292,72585,72731,72878,73024,73170,73317,73463,73609,73609,73756,73975,74195,74341,74341,74634,74707,74780,74926,74926,75073,75073,75219,75219,75219,75365,75512,75512,75658,75658,75804,75804,75804,75951,76097,76097,76390,76390,76390,76536,76682,76682,76829,76829,76975,76975,76975,77268,77268,77414,77560,77560,77561,77707,77853,77853,77999,77999,78146,78146,78146,78292,78439,78439,78731,78732,78732,78878,79024,79024,79170,79171,79317,79317,79463,79609,79609,79756,79902,79902,80048,80195,80341,80341,80487,80487,80634,80780,80780,80926,80926,81073,81073,81073,81219,81365,81512,81512,81658,81658,81658,81951,81951,81951,82097,82243,82243,82390,82536,82682,82682,82829,82829,82829,82975,83121,83121,83268,83414,83414,83560,83707,83853,83853,83999,83999,83999,84292,84292,84365,84439,84512,84585,84585,84731,84804,84878,84878,84951,85024,85097,85170,85170,85317,85390,85463,85463,85536,85609,85682,85756,85756,85829,85902,85975,86048,86048,86121,86195,86268,86341,86341,86487,86634,86634,86707,86780,86853,86926,86926,87073,87146,87219,87219,87292,87365,87439,87512,87512,87658,87804,87804,87878,87951,88024,88097,88097,88170,88243,88317,88390,88390,88536,88609,88682,88682,88829,88975,88975,89121,89121,89268,89268,89414,89414,89560,89560,89707,89707,89853,89853,89999,89999,90146,90146,90292,90292,90439,90439,90585,90585,90731,90731,90878,90878,91024,91024,91170,91170,91317,91317,91390,91463,91536,91609,91682,91756,91829,91902,91975,92048,92121,92195,92268,92341,92634,92780,92926,93219,93365,93365,93365,93365,93658,93658,93804,93878,93951,93951,94097,94243,94317,94390,94463,94536,94536,94682,94829,94829,94975,95121,95121,95268,95414,95487,95560,95634,95707,95707,95853,95853,95999,95999,96146,96292,96292,96292,96439,96585,96585,96658,96731,96804,96878,96878,97024,97170,97170,97317,97390,97463,97463,97609,97756,97756,97829,97902,98048,98048,98048,98195,98341,98341,98487,98560,98634,98634,98780,98926,98926,99073,99219,99219,99365,99512,99512,99658,99804,99804,99951,100097,100170,100243,100317,100390,100390,100536,100682,100682,100829,100975,100975,100975,101121,101268,101268,101341,101414,101487,101560,101560,101707,101853,101853,101926,101999,102073,102146,102146,102292,102439,102439,102439,102585,102658,102731,102731,102878,103024,103024,103024,103170,103243,103317,103317,103317,103463,103609,103682,103756,103829,103902,103902,104048,104195,104195,104341,104487,104487,104487,104634,104780,104853,104926,104999,105073,105073,105219,105365,105365,105512,105658,105658,105658,105804,105951,105951,106097,106170,106243,106243,106317,106390,106536,106536,106682,106756,106829,106829,106829,106975,107121,107121,107268,107268,107414,107414,107414,107560,107707,107707,107707,107853,107999,107999,107999,108146,108292,108292,108439,108585,108585,108731,108878,108878,108878,109024,109170,109170,109317,109463,109463,109536,109609,109682,109756,109756,109902,110048,110048,110048,110195,110195,110341,110341,110341,110487,110487,110634,110634,110634,110780,110780,110926,110926,110926,111073,111073,111219,111219,111219,111365,111512,111658,111731,111804,111878,111951,112024,112097,112097,112097,112390,112390,112536,112682,112682,112682,112829,112975,112975,113121,113268,113268,113414,113560,113560,113707,113853,113853,113999,114146,114219,114292,114365,114439,114439,114585,114731,114731,114878,115024,115024,115024,115170,115317,115317,115463,115536,115609,115609,115756,115902,115902,115975,116048,116121,116195,116195,116268,116341,116414,116487,116487,116560,116634,116707,116780,116780,116926,117073,117073,117219,117365,117365,117512,117658,117658,117804,117878,117951,117951,118097,118243,118243,118390,118536,118536,118682,118829,118902,118975,119048,119121,119121,119268,119414,119414,119560,119707,119707,119853,119999,119999,120146,120292,120292,120439,120439,120731,121024,121170,121463,121536,121609,121682,121756,121756,121756,121902,122048,122048,122048,122195,122341,122341,122341,122487,122560,122634,122634,122634,122780,122926,122926,122926,123073,123219,123219,123219,123365,123512,123512,123512,123585,123658,123731,123804,123804,123804,123951,124097,124097,124097,124243,124390,124390,124390,124536,124682,124682,124682,124829,124975,124975,124975,125121,125268,125268,125268,125414,125487,125560,125560,125560,125707,125853,125853,125853,125999,126146,126146,126146,126292,126439,126439,126439,126585,126585,126731,126731,126878,126878,127024,127024,127024,127170,127170,127317,127317,127463,127463,127609,127609,127609,127756,127756,127902,127902,128048,128048,128195,128195,128268,128341,128341,128414,128487,128487,128560,128634,128707,128780,128780,128853,128926,128999,129073,129146,129219,129292,129365,129365,129439,129512,129585,129658,129731,129804,129878,129951,129951,130024,130097,130170,130243,130243,130317,130390,130463,130536,130536,130682,130756,130829,130829,130829,130975,130975,131121,131195,131268,131341,131560,131707,131707,131780,131853,131926,132146,132292,132365,132439,132512,132731,132878,132878,132951,133024,133097,133463,133463,133756,134048,134048,134048,134341,134634,134634,134926,134926,135219,135219,135219,135512,135512,135658,135658,135804,135804,135951,135951,136097,136097,136243,136243,136390,136390,136536,136536,136609,136682,136682,136829,136829,136902,136975,136975,137121,137121,137268,137268,137414,137414,137560,137560,137707,137707,137780,137853,137926,137999,137999,138073,138146,138146,138219,138292,138365,138439,138439,138512,138585,138658,138731,138731,138804,138878,138951,139024,139024,139097,139170,139243,139317,139317,139463,139463,139609,139609,139756,139756,139902,139902,140195,140195,140195,140195 &#125;;</span><br><span class="line"> </span><br><span class="line">DWORD __ROR4__(DWORD a1, char a2)</span><br><span class="line">&#123;</span><br><span class="line">  return (a1 &gt;&gt; a2) | (a1 &lt;&lt; (32 - a2));</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">int rounds(uint8_t* bytes, unsigned int a2, int a3)</span><br><span class="line">&#123;</span><br><span class="line">  DWORD* v3; // r4</span><br><span class="line">  DWORD v4; // r12</span><br><span class="line">  DWORD v5[2]; // r5</span><br><span class="line">  DWORD v6; // r3</span><br><span class="line">  DWORD result; // r0</span><br><span class="line"> </span><br><span class="line">  v3 = (DWORD*)((char*)bytes + a3);</span><br><span class="line">  v4 = *(DWORD*)((char*)bytes + a3);</span><br><span class="line">  *(DWORD64*)&amp;v5[0] = *(DWORD64*)((char*)bytes + a3 + 4);</span><br><span class="line">  v6 = *(DWORD*)((char*)bytes + a3 + 12);</span><br><span class="line">  *(DWORD*)((char*)bytes + a3) = *(&amp;v5[0] + 1);</span><br><span class="line">  result = v4 ^ __ROR4__(*(&amp;v5[0] + 1) ^ a2, 19);</span><br><span class="line">  v3[3] = v5[0] ^ __ROR4__(v6, 18) ^ __ROR4__(*(&amp;v5[0] + 1) ^ a2, 19);</span><br><span class="line">  v3[1] = v6;</span><br><span class="line">  v3[2] = result;</span><br><span class="line">  return result;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">int main(int argc, char const* argv[])</span><br><span class="line">&#123;</span><br><span class="line">  unsigned char enc_bytes[] =</span><br><span class="line">  &#123;</span><br><span class="line">    0x3C, 0xAC, 0x92, 0x6F, 0x44, 0xA1, 0xC1, 0x17, 0xFD, 0x62,</span><br><span class="line">    0x60, 0xDD, 0x63, 0xF8, 0xE3, 0x2A, 0x5E, 0x75, 0x78, 0xBE,</span><br><span class="line">    0x59, 0x46, 0x33, 0xF6, 0x2E, 0x64, 0x61, 0x8A, 0x27, 0x93,</span><br><span class="line">    0x21, 0x7D, 0x00</span><br><span class="line">  &#125;;</span><br><span class="line">  mt19937 rng(-196167794);</span><br><span class="line">  for (int i = 0; i &lt; 1608; ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    if (rng() % 7 &gt;= 3)</span><br><span class="line">    &#123;</span><br><span class="line">      rounds(enc_bytes, rng(), hitp[i] &amp; 0xF);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  printf(&quot;%s\n&quot;, enc_bytes);</span><br><span class="line">  getchar();</span><br><span class="line">  return 0;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>其实update函数也可以直接调用，用frida写个脚本就行了</p>
<p>虽然这学期学了但是试了好久一直不行，算了下学期带个真机来试试^_^</p>
<p>但是这道题确实分析了好久，有个疑惑是分析了好久的0.02最后好像没有用，可能有别的做法吧，我太笨了没想出来捏::&gt;_&lt;::</p>
<h5 id="N1CTF2018-baby-unity3d"><a href="#N1CTF2018-baby-unity3d" class="headerlink" title="[N1CTF2018] baby unity3d"></a>[N1CTF2018] baby unity3d</h5><p>这道题就是dat文件给加密了一下，这道题真不错O(∩_∩)O~~</p>
<p>一般正常的dat文件开头四字节都是 AF 1B B1 FA，010打开发现这个被加密过了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">注意，IL2CppDumper是使用C#写的，C#在windows平台上是小端字节序，即数据的高字节保存在内存的高地址中，我们上面使用010Editor看二进制文件的时候，从左到右地址是升高的，所以上面的AF 1B B1 FA对应到C#代码中就是0xFAB11BAF，不要搞反了哦。</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2216959">Il2cpp逆向:global-metadata解密-腾讯云开发者社区-腾讯云</a></p>
<p>看到这篇文章的思路特别好，膜拜</p>
<p>有两条一个是用frida找程序运行时文件头AF 1B B1 FA，因为有可能程序运行时把它解密了dump出解密后的文件，但是这题没有用</p>
<p>另一是根据dat的加载流程分析，先记一下又学到了捏</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">il2cpp_init</span><br><span class="line">  -&gt; il2cpp::vm::Runtime::Init</span><br><span class="line">    -&gt; il2cpp::vm::MetadataCache::Initialize</span><br><span class="line">      -&gt; il2cpp::vm::MetadataLoader::LoadMetadataFile</span><br></pre></td></tr></table></figure>

<p>后续的就是分析函数了，就略过了</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>其实总的来看就是围绕这几个文件分析，会个大概思路就行。</p>
<p>突然想起来起因是做到一个rpg游戏想放一起对比的，后来发现那个游戏思路也差不多用ce断一下，在内存里找加密，就先不再赘述了。</p>
<p>麻鸭最近花太多时间在这上面了，可能是期末考试把这个战线拉得特别长了，而且有些题确实让我涨知识了，之前没写过dll，也没了解过系统里面的函数啥的，虽然最后也没成功给我起得要高血压了。。</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta"><i class="fas fa-circle-user fa-fw"></i>文章作者: </span><span class="post-copyright-info"><a href="http://example.com">爱学习居士</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta"><i class="fas fa-square-arrow-up-right fa-fw"></i>文章链接: </span><span class="post-copyright-info"><a href="http://example.com/posts/a1786872/">http://example.com/posts/a1786872/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta"><i class="fas fa-circle-exclamation fa-fw"></i>版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来源 <a href="http://example.com" target="_blank">爱学习居士</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/u3d/">u3d</a></div><div class="post-share"><div class="social-share" data-image="/image/2.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><a class="pagination-related" href="/posts/177574ba/" title="ollvm小记"><img class="cover" src="/image/5.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="info"><div class="info-1"><div class="info-item-1">上一篇</div><div class="info-item-2">ollvm小记</div></div><div class="info-2"><div class="info-item-1">其实这学期初就接触到零碎的东西，但是五月初才完全实践了一下，记录一下&#x2F;(^o^)&#x2F;~ ollvm与llvmollvm是 llvm编译器框架的一种扩展，它用于实现 代码混淆，即故意使程序的源代码或二进制代码变得更加难以理解、逆向工程或破解。 ollvm的混淆是通过修改 llvm IR 实现的，整个项目包含了三个相对独立的LLVM pass，每个pass实现了一种混淆方式。 ollvm其衍生技术仍然是当前移动应用安全加固（包括iOS和Android）中的重要工具之一，尤其是在代码混淆和反逆向工程领域。 当然啦，技术在不断的更新先做这方面的了解。  这里有几个概念记一下： IRIR 介于高级语言（如C&#x2F;C++）和机器码之间，抽象了硬件细节，使编译器能跨平台优化。 1源代码 → IR → 目标机器码（x86/ARM等）  LLVM IR有两种文件格式.ll和.bc，.ll 文件和 .bc 文件都是 LLVM 中间表示的不同表示形式。 .ll 文件是文本形式的可读表示，方便分析和调试 .bc...</div></div></div></a><a class="pagination-related" href="/posts/a9fb130b/" title="那晚c和python都喝醉了"><img class="cover" src="/image/10.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="info text-right"><div class="info-1"><div class="info-item-1">下一篇</div><div class="info-item-2">那晚c和python都喝醉了</div></div><div class="info-2"><div class="info-item-1"> 最近新做了一种题型，感觉以后考的应该挺多的，然后干脆放一起总结一下吧，因为也算是re入门的一部分Y(^o^)Y python解包首先拿到一个exe文件它的外形长这样，基本就是用pyinsatller打包的exe文件  用工具查一下有pyinsatller显示出来  python逆向基础流程（纯小白教程）_python exe逆向-CSDN博客 解法也很简单下一个pyinstxtractor，放一个文件夹下解包就可以了，这个是正统的方法 像我这种不正经的人就会想歪门邪道用在线的，但是孩子们不要学歪哈(^_^) 解开之后拿到pyc文件，然后用一个库拿到py文件，当然也有快速的方法，但是太求速度也不好，尽量知道正常的怎么做 1uncompyle6...</div></div></div></a></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info text-center"><div class="avatar-img"><img src="/image/avatar.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info-name">爱学习居士</div><div class="author-info-description">失之东隅 收之桑榆</div><div class="site-data"><a href="/archives/"><div class="headline">文章</div><div class="length-num">7</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">5</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">5</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">失之东隅 收之桑榆</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#unity3D"><span class="toc-text">unity3D</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Momo%E5%87%BA%E5%8C%85"><span class="toc-text">Momo出包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#BJDCTF2020-BJD-hamburger-competition"><span class="toc-text">[BJDCTF2020]BJD hamburger competition</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#IL2CPP%E5%87%BA%E5%8C%85"><span class="toc-text">IL2CPP出包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#PC"><span class="toc-text">PC</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#LitCTF2025-Robbie-Wanna-Revenge"><span class="toc-text">[LitCTF2025]Robbie Wanna Revenge</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#MRCTF2021-EzGame"><span class="toc-text">[MRCTF2021] EzGame</span></a><ol class="toc-child"><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-text">方法一</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C"><span class="toc-text">方法二</span></a></li><li class="toc-item toc-level-6"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%89"><span class="toc-text">方法三</span></a></li></ol></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Android"><span class="toc-text">Android</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#D3CTF-2022-D3MUG"><span class="toc-text">[D3CTF 2022] D3MUG</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#N1CTF2018-baby-unity3d"><span class="toc-text">[N1CTF2018] baby unity3d</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-text">总结</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/4eb716cb/" title="lil"><img src="/image/18.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="lil"/></a><div class="content"><a class="title" href="/posts/4eb716cb/" title="lil">lil</a><time datetime="2025-08-24T07:34:12.000Z" title="发表于 2025-08-24 15:34:12">2025-08-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/af13bc4e/" title="日常1"><img src="/image/23.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="日常1"/></a><div class="content"><a class="title" href="/posts/af13bc4e/" title="日常1">日常1</a><time datetime="2025-08-01T02:02:39.000Z" title="发表于 2025-08-01 10:02:39">2025-08-01</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/3cc884dc/" title="小小vm"><img src="/image/19.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="小小vm"/></a><div class="content"><a class="title" href="/posts/3cc884dc/" title="小小vm">小小vm</a><time datetime="2025-07-16T01:48:30.000Z" title="发表于 2025-07-16 09:48:30">2025-07-16</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a9fb130b/" title="那晚c和python都喝醉了"><img src="/image/10.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="那晚c和python都喝醉了"/></a><div class="content"><a class="title" href="/posts/a9fb130b/" title="那晚c和python都喝醉了">那晚c和python都喝醉了</a><time datetime="2025-07-15T11:58:56.000Z" title="发表于 2025-07-15 19:58:56">2025-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/a1786872/" title="游戏游戏游戏O(∩_∩)O~~"><img src="/image/2.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="游戏游戏游戏O(∩_∩)O~~"/></a><div class="content"><a class="title" href="/posts/a1786872/" title="游戏游戏游戏O(∩_∩)O~~">游戏游戏游戏O(∩_∩)O~~</a><time datetime="2025-07-08T10:39:25.000Z" title="发表于 2025-07-08 18:39:25">2025-07-08</time></div></div></div></div></div></div></main><footer id="footer"><div class="footer-other"><div class="footer-copyright"><span class="copyright">&copy;2025 By 爱学习居士</span><span class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo 7.3.0</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly 5.4.0-b1</a></span></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="日间和夜间模式切换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><div class="js-pjax"></div><script async src="/js/title.js"></script><script defer src="/live2d-widget-master/autoload.js"></script><script src="/js/sakura.js"></script><canvas class="fireworks" mobile="false"></canvas><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/fireworks.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = true;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><script>(() => {
  const destroyAplayer = () => {
    if (window.aplayers) {
      for (let i = 0; i < window.aplayers.length; i++) {
        if (!window.aplayers[i].options.fixed) {
          window.aplayers[i].destroy()
        }
      }
    }
  }

  const runMetingJS = () => {
    typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()
  }

  btf.addGlobalFn('pjaxSend', destroyAplayer, 'destroyAplayer')
  btf.addGlobalFn('pjaxComplete', loadMeting, 'runMetingJS')
})()</script><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>(() => {
  const pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

  window.pjax = new Pjax({
    elements: 'a:not([target="_blank"])',
    selectors: pjaxSelectors,
    cacheBust: false,
    analytics: false,
    scrollRestoration: false
  })

  const triggerPjaxFn = (val) => {
    if (!val) return
    Object.values(val).forEach(fn => fn())
  }

  document.addEventListener('pjax:send', () => {
    // removeEventListener
    btf.removeGlobalFnEvent('pjaxSendOnce')
    btf.removeGlobalFnEvent('themeChange')

    // reset readmode
    const $bodyClassList = document.body.classList
    if ($bodyClassList.contains('read-mode')) $bodyClassList.remove('read-mode')

    triggerPjaxFn(window.globalFn.pjaxSend)
  })

  document.addEventListener('pjax:complete', () => {
    btf.removeGlobalFnEvent('pjaxCompleteOnce')
    document.querySelectorAll('script[data-pjax]').forEach(item => {
      const newScript = document.createElement('script')
      const content = item.text || item.textContent || item.innerHTML || ""
      Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
      newScript.appendChild(document.createTextNode(content))
      item.parentNode.replaceChild(newScript, item)
    })

    triggerPjaxFn(window.globalFn.pjaxComplete)
  })

  document.addEventListener('pjax:error', e => {
    if (e.request.status === 404) {
      const usePjax = true
      false
        ? (usePjax ? pjax.loadUrl('/404.html') : window.location.href = '/404.html')
        : window.location.href = e.request.responseURL
    }
  })
})()</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>